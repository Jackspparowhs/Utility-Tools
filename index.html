<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <title>Utility Tools by PirateRuler.com â€” Lightweight web utilities</title>
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <meta name="description" content="Utility Tools by PirateRuler.com â€” Notes, stopwatch, date diff, world clock, password generator, converters and text helpers â€” private and lightweight." />
  <meta name="theme-color" content="#0b6bff" />
  <style>
    /* =========================
       Root / Theme variables
       ========================= */
    :root{
      --bg: #f4f8fb;
      --card: #ffffff;
      --muted: #6f8699;
      --text: #062033;
      --accent1: linear-gradient(90deg,#6b7dff,#0bb3ff);
      --radius: 16px;
      --glass: rgba(255,255,255,0.85);
      --shadow: 0 18px 45px rgba(6,32,56,0.08);
      --blur: 14px;
      --btn-shadow: 0 10px 25px rgba(11,107,255,0.14);
    }
    [data-theme="dark"]{
      --bg: #061223;
      --card: rgba(6,18,35,0.90);
      --muted: #9fb3cc;
      --text: #e6f1ff;
      --accent1: linear-gradient(90deg,#2f5bff,#0bb3ff);
      --shadow: 0 14px 40px rgba(3,10,20,0.6);
      --glass: rgba(255,255,255,0.02);
      --btn-shadow: 0 10px 25px rgba(2,10,30,0.45);
    }

    /* =========================
       Base
       ========================= */
    html,body{height:100%;margin:0;font-family: Inter, system-ui, -apple-system, "Segoe UI", Roboto, "Helvetica Neue", Arial; background: radial-gradient(1200px 600px at 10% 10%, rgba(107,125,255,0.06), transparent), var(--bg); color:var(--text); -webkit-font-smoothing:antialiased; -moz-osx-font-smoothing:grayscale;}
    a{color:inherit;text-decoration:none}
    .page{max-width:1100px;margin:20px auto;padding:20px;display:flex;flex-direction:column;gap:22px}
    .rounded-card{background:var(--card);border-radius:18px;box-shadow:var(--shadow);padding:18px;}

    /* Header */
    .site-header{display:flex;align-items:center;justify-content:space-between;gap:12px;padding:12px;border-radius:16px;background:linear-gradient(180deg, rgba(255,255,255,0.7), rgba(255,255,255,0.5));box-shadow:var(--shadow);}
    [data-theme="dark"] .site-header{background:linear-gradient(180deg, rgba(255,255,255,0.02), rgba(255,255,255,0.01))}
    .brand{display:flex;align-items:center;gap:14px}
    .logo{width:54px;height:54px;border-radius:14px;background:var(--accent1);display:flex;align-items:center;justify-content:center;color:#fff;font-weight:800;font-size:20px;box-shadow:var(--btn-shadow)}
    .brand h1{margin:0;font-size:20px;letter-spacing:-0.02em}
    .brand p{margin:0;color:var(--muted);font-size:13px;margin-top:2px}

    /* header controls */
    .controls{display:flex;align-items:center;gap:12px}
    .btn{border:0;padding:8px 14px;border-radius:12px;cursor:pointer;font-weight:700;background:transparent;color:var(--text);box-shadow: none}
    .btn-ghost{background:transparent;border:1px solid rgba(0,0,0,0.06);padding:10px;border-radius:12px}
    .theme-toggle{padding:8px 12px;border-radius:12px;background:var(--card);box-shadow:var(--shadow);display:flex;gap:8px;align-items:center;cursor:pointer}
    .hambtn{width:46px;height:46px;border-radius:12px;background:var(--card);box-shadow:var(--shadow);display:grid;place-items:center;cursor:pointer}

    /* Hero */
    .hero{padding:28px;border-radius:18px;background:linear-gradient(180deg, rgba(255,255,255,0.85), rgba(255,255,255,0.7));box-shadow:var(--shadow);text-align:center}
    [data-theme="dark"] .hero{background:transparent}
    .hero h2{font-size:34px;margin:0 0 6px;font-weight:800}
    .hero p{margin:0;color:var(--muted);max-width:820px;margin-left:auto;margin-right:auto}

    /* quick buttons */
    .tool-grid{display:flex;flex-wrap:wrap;gap:10px;justify-content:center;margin-top:18px}
    .tool-btn{background:transparent;border-radius:28px;padding:10px 16px;border:1px solid rgba(2,8,20,0.05);font-weight:700;color:var(--text);cursor:pointer;transition:transform .16s, box-shadow .16s}
    .tool-btn:hover{transform:translateY(-3px);box-shadow:0 12px 28px rgba(2,8,20,0.06)}
    .tool-btn.primary{background:var(--accent1);color:#fff;box-shadow:var(--btn-shadow)}

    /* main layout */
    .main-grid{display:grid;grid-template-columns:1fr;gap:18px}
    @media(min-width:980px){ .main-grid{grid-template-columns:1fr 420px} }

    /* cards */
    .card{border-radius:16px;background:var(--card);padding:16px;box-shadow:var(--shadow);min-height:60px;transition:transform .18s}
    .card h3{margin:0 0 8px;font-size:18px}
    .card .hint{color:var(--muted);font-size:14px}

    /* World clock list */
    .tz-row{display:flex;gap:10px;flex-wrap:wrap}
    .tz-chip{padding:10px 12px;border-radius:12px;background:rgba(0,0,0,0.03);font-weight:700;min-width:120px;text-align:center}

    /* small controls */
    input[type="text"], input[type="date"], input[type="number"], textarea, select {
      width:100%;padding:11px;border-radius:12px;border:1px solid rgba(2,8,20,0.06);background:transparent;font-size:15px;color:var(--text);outline:none;
    }
    textarea{min-height:120px;resize:vertical}

    .row{display:flex;gap:10px;align-items:center}
    .g-2{display:grid;grid-template-columns:1fr 1fr;gap:10px}
    @media(max-width:540px){ .g-2{grid-template-columns:1fr} }

    /* footer */
    footer{padding:18px;border-radius:14px;background:linear-gradient(180deg,rgba(255,255,255,0.85),rgba(255,255,255,0.6));text-align:center;box-shadow:var(--shadow)}
    [data-theme="dark"] footer{background:transparent}

    /* sidebar overlay */
    .sidebar{position:fixed;right:18px;top:84px;z-index:120;transition:transform .28s ease;transform:translateX(0)}
    .sidebar-panel{width:320px;background:var(--card);padding:16px;border-radius:14px;box-shadow:var(--shadow);backdrop-filter: blur(var(--blur));}
    .sidebar .link{display:block;padding:12px 10px;border-radius:10px;color:var(--text);font-weight:600}
    .sidebar .small{color:var(--muted);font-size:13px;margin-top:8px}

    /* floating anchor */
    .float-visit{display:inline-block;padding:12px 22px;border-radius:28px;background:var(--accent1);color:#fff;font-weight:800;box-shadow:var(--btn-shadow)}

    /* subtle animations */
    .fade-in{animation:fadeIn .6s ease both}
    @keyframes fadeIn{from{opacity:0;transform:translateY(8px)}to{opacity:1;transform:none}}

    /* icons */
    .icon{display:inline-block;width:18px;height:18px;vertical-align:middle;margin-right:8px}

    /* small helpers */
    .muted{color:var(--muted)}
    .result{font-weight:800;color:var(--text);font-size:16px;margin-top:8px}

    /* small responsive */
    @media(max-width:640px){
      .site-header{padding:10px}
      .logo{width:48px;height:48px}
      .brand h1{font-size:18px}
      .hero h2{font-size:22px}
      .sidebar{right:10px;top:72px}
      .sidebar-panel{width:92vw}
    }
  </style>
</head>
<body data-theme="">
  <div class="page">

    <!-- Header -->
    <header class="site-header rounded-card fade-in" role="banner">
      <div class="brand" role="navigation" aria-label="Home">
        <a href="/" style="display:flex;align-items:center;gap:12px">
          <div class="logo" aria-hidden="true">PR</div>
          <div>
            <h1 id="main-title">Utility Tools</h1>
            <p id="byline">by <a href="https://pirateruler.com" target="_blank" rel="noopener noreferrer" style="color:var(--muted);font-weight:700">PirateRuler.com</a></p>
          </div>
        </a>
      </div>

      <div class="controls" role="toolbar" aria-label="Top actions">
        <div class="theme-toggle" id="themeToggle" title="Toggle theme" role="button" tabindex="0">
          <span id="themeLabel">Light</span>
        </div>
        <div class="hambtn" id="openSidebar" title="Open menu" aria-expanded="false" role="button">
          &#9776;
        </div>
      </div>
    </header>

    <!-- Hero -->
    <section class="hero rounded-card fade-in" aria-labelledby="hero-title">
      <h2 id="hero-title">All-in-one Utility Tools</h2>
      <p>Everyday quick tools people love â€” zero APIs, instant execution. Notes, stopwatch, date difference, world clock, password generator, converters and text helpers â€” private and lightweight.</p>

      <div class="tool-grid" role="list">
        <button class="tool-btn primary" data-tool="notes">Notes</button>
        <button class="tool-btn" data-tool="stopwatch">Stopwatch</button>
        <button class="tool-btn" data-tool="datediff">Date Diff</button>
        <button class="tool-btn" data-tool="worldclock">World Clock</button>
        <button class="tool-btn" data-tool="password">Password</button>
        <button class="tool-btn" data-tool="clipboard">Clipboard</button>
        <button class="tool-btn" data-tool="filesize">File Size</button>
        <button class="tool-btn" data-tool="charword">Char/Word</button>
        <button class="tool-btn" data-tool="caseconv">Case Conv</button>
        <button class="tool-btn" data-tool="textformat">Text Format</button>
      </div>
    </section>

    <!-- main -->
    <div class="main-grid">

      <!-- left: tools -->
      <main>
        <!-- Notes -->
        <section id="notes" class="card fade-in" hidden>
          <h3>Notes (auto-saved locally)</h3>
          <div class="hint">Quick notes stored in your browser (localStorage).</div>
          <textarea id="notesBox" placeholder="Type notes here..."></textarea>
          <div style="display:flex;gap:10px;margin-top:10px;">
            <button class="tool-btn primary" id="saveNotes">Save</button>
            <button class="tool-btn" id="clearNotes">Clear</button>
            <div class="muted" id="notesStatus">Autosave off</div>
          </div>
        </section>

        <!-- Stopwatch -->
        <section id="stopwatch" class="card fade-in" hidden>
          <h3>Stopwatch & Timer</h3>
          <div style="display:flex;gap:12px;align-items:center;">
            <div style="font-weight:900;font-size:26px" id="sw-display">00:00:00.00</div>
            <div style="margin-left:auto;display:flex;gap:8px">
              <button class="tool-btn primary" id="sw-start">Start</button>
              <button class="tool-btn" id="sw-stop">Stop</button>
              <button class="tool-btn" id="sw-reset">Reset</button>
            </div>
          </div>
          <div style="margin-top:12px" id="laps"></div>
        </section>

        <!-- Date diff -->
        <section id="datediff" class="card fade-in" hidden>
          <h3>Date difference</h3>
          <div class="g-2">
            <input id="dd-from" type="date" />
            <input id="dd-to" type="date" />
          </div>
          <div style="display:flex;gap:10px;margin-top:10px;">
            <button class="tool-btn primary" onclick="calcDateDiff()">Calculate</button>
            <button class="tool-btn" onclick="document.getElementById('dd-from').value='';document.getElementById('dd-to').value=''">Clear</button>
          </div>
          <div class="result" id="dd-res" aria-live="polite"></div>
        </section>

        <!-- World clock -->
        <section id="worldclock" class="card fade-in" hidden>
          <h3>World clock</h3>
          <div class="hint">Local time and selected timezones â€” updates each second.</div>
          <div style="display:flex;gap:10px;align-items:center;margin-top:8px">
            <div style="font-weight:800">Local:</div>
            <div id="localTime" style="margin-left:6px;font-weight:700"></div>
            <div style="margin-left:auto;display:flex;gap:6px;align-items:center;">
              <select id="tz-select" aria-label="Add timezone">
                <!-- some common zones; you can expand -->
                <option value="UTC">UTC</option>
                <option value="Europe/London">London</option>
                <option value="Europe/Paris">Paris</option>
                <option value="Asia/Kolkata">India (Kolkata)</option>
                <option value="Asia/Tokyo">Tokyo</option>
                <option value="America/New_York">New York</option>
                <option value="America/Los_Angeles">Los Angeles</option>
                <option value="Australia/Sydney">Sydney</option>
              </select>
              <button class="tool-btn" id="tz-add">Add</button>
            </div>
          </div>
          <div class="tz-row" id="tz-list" style="margin-top:12px"></div>
        </section>

        <!-- Password generator -->
        <section id="password" class="card fade-in" hidden>
          <h3>Password generator</h3>
          <div class="g-2">
            <input id="pw-length" type="number" value="16" min="6" max="128" />
            <select id="pw-type">
              <option value="all">Letters + Numbers + Symbols</option>
              <option value="alnum">Letters + Numbers</option>
              <option value="num">Numbers only</option>
            </select>
          </div>
          <div style="display:flex;gap:10px;margin-top:10px;">
            <button class="tool-btn primary" id="genPw">Generate</button>
            <button class="tool-btn" id="copyPw">Copy</button>
            <div class="muted" id="pwMsg"></div>
          </div>
          <input id="pwOut" type="text" placeholder="Generated password" style="margin-top:10px" readonly />
        </section>

        <!-- Clipboard / Helpers -->
        <section id="clipboard" class="card fade-in" hidden>
          <h3>Clipboard & Helpers</h3>
          <textarea id="clipIn" placeholder="Paste or type text here..."></textarea>
          <div style="display:flex;gap:8px;margin-top:8px;">
            <button class="tool-btn primary" id="copyText">Copy</button>
            <button class="tool-btn" id="clearText">Clear</button>
          </div>
        </section>

        <!-- File size converter -->
        <section id="filesize" class="card fade-in" hidden>
          <h3>File size converter</h3>
          <div class="g-2">
            <input id="fs-amount" type="number" step="any" placeholder="Amount" />
            <select id="fs-from">
              <option>Bytes</option><option>KB</option><option>MB</option><option>GB</option><option>TB</option>
            </select>
          </div>
          <div style="display:flex;gap:8px;margin-top:8px">
            <select id="fs-to">
              <option>KB</option><option>Bytes</option><option>MB</option><option>GB</option><option>TB</option>
            </select>
            <button class="tool-btn primary" onclick="convertFileSize()">Convert</button>
          </div>
          <div id="fs-res" class="result"></div>
        </section>

        <!-- Char / Word counter -->
        <section id="charword" class="card fade-in" hidden>
          <h3>Character & Word counter</h3>
          <textarea id="cw-in" placeholder="Paste text here..."></textarea>
          <div style="display:flex;gap:10px;margin-top:8px;">
            <button class="tool-btn primary" onclick="countCW()">Count</button>
            <button class="tool-btn" onclick="document.getElementById('cw-in').value=''">Clear</button>
          </div>
          <div id="cw-res" class="result"></div>
        </section>

        <!-- Case converter -->
        <section id="caseconv" class="card fade-in" hidden>
          <h3>Case converter</h3>
          <textarea id="case-in" placeholder="Text..."></textarea>
          <div style="display:flex;gap:8px;margin-top:8px;">
            <button class="tool-btn" onclick="transformCase('upper')">UPPER</button>
            <button class="tool-btn" onclick="transformCase('lower')">lower</button>
            <button class="tool-btn" onclick="transformCase('title')">Title Case</button>
            <button class="tool-btn" onclick="document.getElementById('case-in').value=''">Clear</button>
          </div>
        </section>

        <!-- Text formatter -->
        <section id="textformat" class="card fade-in" hidden>
          <h3>Text formatter / indenter</h3>
          <div class="hint">JSON pretty-print, JSON minify, basic HTML tidy, or copy output.</div>
          <textarea id="tf-in" placeholder='Paste JSON or HTML here...'></textarea>
          <div style="display:flex;gap:8px;margin-top:8px;flex-wrap:wrap;">
            <button class="tool-btn primary" onclick="tfPretty()">JSON pretty</button>
            <button class="tool-btn" onclick="tfMinify()">JSON minify</button>
            <button class="tool-btn" onclick="tfHtmlTidy()">HTML tidy (basic)</button>
            <button class="tool-btn" onclick="copyToClipboard(document.getElementById('tf-in').value)">Copy</button>
            <button class="tool-btn" onclick="document.getElementById('tf-in').value=''">Clear</button>
          </div>
        </section>

      </main>

      <!-- right column: highlights + quick links -->
      <aside>
        <div class="card fade-in">
          <h3 style="margin-top:6px">Why Utility Tools?</h3>
          <div class="hint">Small, private, and offline-capable helpers you can run anywhere. No signups, no tracking.</div>
          <div style="margin-top:14px;display:flex;flex-direction:column;gap:8px">
            <div style="display:flex;gap:10px;align-items:center">
              <div style="width:52px;height:52px;border-radius:12px;background:linear-gradient(180deg,#ffd6a6,#ff8fb3);display:grid;place-items:center;color:#fff;font-weight:800">âš¡</div>
              <div>
                <strong>Lightning fast</strong>
                <div class="muted">Optimized code, minimal dependencies â€” instant on mobile & desktop.</div>
              </div>
            </div>

            <div style="display:flex;gap:10px;align-items:center">
              <div style="width:52px;height:52px;border-radius:12px;background:linear-gradient(180deg,#98f6b7,#59d0ff);display:grid;place-items:center;color:#fff;font-weight:800">ðŸ”’</div>
              <div>
                <strong>Private by design</strong>
                <div class="muted">No personal data is stored â€” everything runs in your browser.</div>
              </div>
            </div>

            <div style="display:flex;gap:10px;align-items:center">
              <div style="width:52px;height:52px;border-radius:12px;background:linear-gradient(180deg,#ffb86b,#9b7cff);display:grid;place-items:center;color:#fff;font-weight:800">ðŸ§°</div>
              <div>
                <strong>All tools in one</strong>
                <div class="muted">Notes, stopwatch, converters, text tools â€” ready to use.</div>
              </div>
            </div>
          </div>
        </div>

        <div class="card fade-in" style="margin-top:14px;">
          <strong>Quick links</strong>
          <div style="margin-top:10px;display:flex;flex-direction:column;gap:8px">
            <a class="link muted" href="https://www.pirateruler.com/post/about.html" target="_blank">About â€” PirateRuler</a>
            <a class="link muted" href="https://www.pirateruler.com/post/privacy.html" target="_blank">Privacy Policy</a>
            <a class="link muted" href="https://www.pirateruler.com/post/contact.html" target="_blank">Contact</a>
            <a class="link muted" href="https://www.pirateruler.com/post/terms.html" target="_blank">Terms & Service</a>
          </div>
          <div style="margin-top:12px">
            <a class="float-visit" href="https://pirateruler.com" target="_blank">Visit PirateRuler.com</a>
          </div>
        </div>
      </aside>
    </div>

    <footer class="rounded-card">
      <div style="display:flex;align-items:center;gap:12px;flex-direction:column">
        <div style="font-weight:800">Utility Tools by PirateRuler.com</div>
        <div class="muted">Lightweight, private web utilities you can run anywhere. No signups, no tracking.</div>
      </div>
    </footer>
  </div>

  <!-- sidebar (hidden by default) -->
  <div id="sidebar" class="sidebar" style="display:none">
    <div class="sidebar-panel fade-in">
      <div style="display:flex;align-items:center;gap:12px">
        <div class="logo">PR</div>
        <div>
          <strong>Utility Tools</strong>
          <div class="muted" style="font-size:13px">by PirateRuler.com â€” Private â€¢ Fast</div>
        </div>
      </div>

      <hr style="border:none;height:10px">

      <a class="link" href="https://www.pirateruler.com/post/about.html" target="_blank">About â€” PirateRuler</a>
      <a class="link" href="https://www.pirateruler.com/post/privacy.html" target="_blank">Privacy Policy</a>
      <a class="link" href="https://www.pirateruler.com/post/contact.html" target="_blank">Contact</a>
      <a class="link" href="https://www.pirateruler.com/post/terms.html" target="_blank">Terms & Service</a>

      <div class="small muted" style="margin-top:12px">Backup</div>
      <div class="muted" style="font-size:14px;margin-top:6px">If this site is offline you can visit the main PirateRuler site for backups and resources:</div>
      <a class="link" href="https://pirateruler.com" target="_blank" style="margin-top:8px">Open PirateRuler.com</a>

      <div style="margin-top:12px;text-align:right">
        <button class="tool-btn" id="closeSidebar">Close</button>
      </div>
    </div>
  </div>

  <script>
    /*********************
      Theme handling
    *********************/
    const html = document.documentElement;
    const themeToggle = document.getElementById('themeToggle');
    const themeLabel = document.getElementById('themeLabel');

    function applyTheme(t){
      html.setAttribute('data-theme', t);
      themeLabel.textContent = (t === 'dark') ? 'Dark' : 'Light';
      // adjust small header background for dark via inline if needed
    }

    const saved = localStorage.getItem('pr-theme') || (window.matchMedia && window.matchMedia('(prefers-color-scheme: dark)').matches ? 'dark' : 'light');
    applyTheme(saved);

    themeToggle.addEventListener('click', () => {
      const current = html.getAttribute('data-theme') === 'dark' ? 'dark' : 'light';
      const next = current === 'dark' ? 'light' : 'dark';
      applyTheme(next);
      localStorage.setItem('pr-theme', next);
    });

    /*********************
      Sidebar
    *********************/
    const openSidebar = document.getElementById('openSidebar');
    const sidebar = document.getElementById('sidebar');
    const closeSidebar = document.getElementById('closeSidebar');

    openSidebar.addEventListener('click', ()=> {
      sidebar.style.display = (sidebar.style.display === 'block') ? 'none' : 'block';
      openSidebar.setAttribute('aria-expanded', sidebar.style.display === 'block');
    });
    closeSidebar.addEventListener('click', ()=> { sidebar.style.display = 'none'; openSidebar.setAttribute('aria-expanded', 'false'); });

    // hide on outside click
    document.addEventListener('click', (e)=> {
      if (!sidebar.contains(e.target) && !openSidebar.contains(e.target)) sidebar.style.display = 'none';
    });

    /*********************
      Tool navigation
    *********************/
    const toolBtns = document.querySelectorAll('.tool-btn[data-tool]');
    toolBtns.forEach(b => b.addEventListener('click', (e)=> {
      const t = b.dataset.tool;
      showTool(t);
      // scroll into view
      const el = document.getElementById(t);
      if (el) el.scrollIntoView({behavior:'smooth', block:'start'});
    }));

    function hideAllTools(){
      document.querySelectorAll('main section.card').forEach(s => s.hidden = true);
    }
    function showTool(id){
      hideAllTools();
      const el = document.getElementById(id);
      if(el) el.hidden = false;
    }

    // default tool: notes
    showTool('notes');

    /*********************
      Notes (localStorage autosave)
    *********************/
    const notesBox = document.getElementById('notesBox');
    const saveNotesBtn = document.getElementById('saveNotes');
    const clearNotesBtn = document.getElementById('clearNotes');
    const notesStatus = document.getElementById('notesStatus');

    const NOTES_KEY = 'pr-notes-v1';
    // load
    notesBox.value = localStorage.getItem(NOTES_KEY) || '';
    notesStatus.textContent = 'Autosaved';

    // autosave on input (debounce)
    let saveTimer;
    notesBox.addEventListener('input', ()=> {
      clearTimeout(saveTimer);
      notesStatus.textContent = 'Saving...';
      saveTimer = setTimeout(()=> {
        localStorage.setItem(NOTES_KEY, notesBox.value);
        notesStatus.textContent = 'Saved';
      }, 500);
    });

    saveNotesBtn.addEventListener('click', ()=> {
      localStorage.setItem(NOTES_KEY, notesBox.value);
      notesStatus.textContent = 'Saved';
    });
    clearNotesBtn.addEventListener('click', ()=> {
      notesBox.value = '';
      localStorage.removeItem(NOTES_KEY);
      notesStatus.textContent = 'Cleared';
    });

    /*********************
      Stopwatch
    *********************/
    let swInterval=null, swStart=0, swElapsed=0;
    const swDisplay = document.getElementById('sw-display');
    const swStartBtn = document.getElementById('sw-start');
    const swStopBtn = document.getElementById('sw-stop');
    const swResetBtn = document.getElementById('sw-reset');
    const laps = document.getElementById('laps');

    function formatMS(ms){
      const hundred = Math.floor((ms%1000)/10);
      const s = Math.floor(ms/1000)%60;
      const m = Math.floor(ms/60000)%60;
      const h = Math.floor(ms/3600000);
      return `${String(h).padStart(2,'0')}:${String(m).padStart(2,'0')}:${String(s).padStart(2,'0')}.${String(hundred).padStart(2,'0')}`;
    }

    swStartBtn.addEventListener('click', ()=> {
      if(swInterval) return;
      swStart = Date.now() - swElapsed;
      swInterval = setInterval(()=> {
        swElapsed = Date.now() - swStart;
        swDisplay.textContent = formatMS(swElapsed);
      }, 30);
    });
    swStopBtn.addEventListener('click', ()=> {
      if(swInterval){ clearInterval(swInterval); swInterval=null; }
    });
    swResetBtn.addEventListener('click', ()=> {
      if(swInterval){ clearInterval(swInterval); swInterval=null; }
      swElapsed = 0;
      swDisplay.textContent = formatMS(0);
      laps.innerHTML = '';
    });

    /*********************
      Date difference
    *********************/
    function calcDateDiff(){
      const a = document.getElementById('dd-from').value;
      const b = document.getElementById('dd-to').value;
      const res = document.getElementById('dd-res');
      if(!a || !b) return res.textContent = 'Please select both dates';
      const da = new Date(a), db = new Date(b);
      if(isNaN(da) || isNaN(db)) return res.textContent = 'Invalid date';
      let diff = Math.abs(db - da);
      const days = Math.floor(diff / (1000*60*60*24));
      const years = Math.floor(days/365);
      const months = Math.floor((days - years*365)/30);
      res.textContent = `${years} years, ${months} months, ${days} days (${days} total days)`;
    }

    /*********************
      World clock
    *********************/
    const tzList = document.getElementById('tz-list');
    const tzSelect = document.getElementById('tz-select');
    const tzAdd = document.getElementById('tz-add');
    let tzZones = JSON.parse(localStorage.getItem('pr-tz') || '["UTC","Asia/Kolkata","Europe/London","America/New_York"]');

    function renderTZ(){
      tzList.innerHTML = '';
      tzZones.forEach(zone => {
        const el = document.createElement('div');
        el.className = 'tz-chip';
        el.innerHTML = `<div style="font-weight:700">${zone}</div><div style="font-size:13px;color:var(--muted)" id="tz-${zone}">--:--:--</div>`;
        const remove = document.createElement('button');
        remove.textContent = 'âœ•';
        remove.style.marginLeft='8px';
        remove.style.background='transparent';
        remove.style.border='none';
        remove.style.cursor='pointer';
        remove.title='Remove';
        remove.addEventListener('click', ()=> {
          tzZones = tzZones.filter(z => z !== zone);
          localStorage.setItem('pr-tz', JSON.stringify(tzZones));
          renderTZ();
        });
        el.appendChild(remove);
        tzList.appendChild(el);
      });
    }
    function updateTimes(){
      // local
      const now = new Date();
      document.getElementById('localTime').textContent = now.toLocaleTimeString();
      tzZones.forEach(zone => {
        try {
          const tzTime = new Intl.DateTimeFormat([], { timeZone: zone, hour: '2-digit', minute:'2-digit', second:'2-digit' }).format(new Date());
          const el = document.getElementById('tz-'+zone);
          if(el) el.textContent = tzTime;
        } catch(e){}
      });
    }
    tzAdd.addEventListener('click', ()=> {
      const val = tzSelect.value;
      if(!tzZones.includes(val)){ tzZones.push(val); localStorage.setItem('pr-tz', JSON.stringify(tzZones)); renderTZ(); }
    });
    renderTZ();
    updateTimes();
    setInterval(updateTimes, 1000);

    /*********************
      Password generator
    *********************/
    const genPw = document.getElementById('genPw');
    const pwOut = document.getElementById('pwOut');
    const pwLength = document.getElementById('pw-length');
    const pwType = document.getElementById('pw-type');
    const copyPw = document.getElementById('copyPw');
    const pwMsg = document.getElementById('pwMsg');

    function randomFrom(chars, n){
      let out = '';
      const len = chars.length;
      for(let i=0;i<n;i++) out += chars[Math.floor(Math.random()*len)];
      return out;
    }
    genPw.addEventListener('click', ()=> {
      const n = parseInt(pwLength.value) || 16;
      let chars = 'abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ0123456789!@#$%^&*()-_=+[]{}|;:,.<>?';
      if(pwType.value === 'alnum') chars = 'abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ0123456789';
      if(pwType.value === 'num') chars = '0123456789';
      pwOut.value = randomFrom(chars, Math.min(256,Math.max(6,n)));
      pwMsg.textContent = 'Generated';
      setTimeout(()=> pwMsg.textContent='', 1400);
    });
    copyPw.addEventListener('click', ()=> {
      copyToClipboard(pwOut.value);
      pwMsg.textContent = 'Copied';
      setTimeout(()=> pwMsg.textContent='', 1200);
    });

    /*********************
      Clipboard copy helper
    *********************/
    function copyToClipboard(text){
      if(!text) return;
      navigator.clipboard?.writeText(text).catch(()=> {
        // fallback
        const ta = document.createElement('textarea'); ta.value = text; document.body.appendChild(ta); ta.select();
        document.execCommand('copy'); ta.remove();
      });
    }
    document.getElementById('copyText').addEventListener('click', ()=> {
      copyToClipboard(document.getElementById('clipIn').value);
    });
    document.getElementById('clearText').addEventListener('click', ()=> document.getElementById('clipIn').value='');

    /*********************
      File size converter
    *********************/
    function convertFileSize(){
      const a = parseFloat(document.getElementById('fs-amount').value);
      const from = document.getElementById('fs-from').value;
      const to = document.getElementById('fs-to').value;
      const map = { 'Bytes':1, 'KB':1024, 'MB':1024**2, 'GB':1024**3, 'TB':1024**4 };
      if(isNaN(a)) return document.getElementById('fs-res').textContent = 'Enter a number';
      const bytes = a * map[from];
      const out = bytes / map[to];
      document.getElementById('fs-res').textContent = `${out} ${to}`;
    }

    /*********************
      Char / Word counter
    *********************/
    function countCW(){
      const txt = document.getElementById('cw-in').value || '';
      const chars = txt.length;
      const words = txt.trim() === '' ? 0 : txt.trim().split(/\s+/).length;
      document.getElementById('cw-res').textContent = `${chars} characters â€¢ ${words} words`;
    }

    /*********************
      Case functions
    *********************/
    function transformCase(mode){
      const el = document.getElementById('case-in');
      let v = el.value || '';
      if(mode === 'upper') el.value = v.toUpperCase();
      if(mode === 'lower') el.value = v.toLowerCase();
      if(mode === 'title') el.value = v.replace(/\w\S*/g, (w)=> w.charAt(0).toUpperCase() + w.substr(1).toLowerCase());
    }

    /*********************
      Text formatter
    *********************/
    function tfPretty(){
      const v = document.getElementById('tf-in').value;
      try{
        const obj = JSON.parse(v);
        document.getElementById('tf-in').value = JSON.stringify(obj, null, 2);
      }catch(e){
        alert('Invalid JSON');
      }
    }
    function tfMinify(){
      const v = document.getElementById('tf-in').value;
      try{
        const obj = JSON.parse(v);
        document.getElementById('tf-in').value = JSON.stringify(obj);
      }catch(e){
        alert('Invalid JSON');
      }
    }
    function tfHtmlTidy(){
      const v = document.getElementById('tf-in').value;
      // very basic tidy: indent one level per tag (not robust, but OK for simple snippets)
      const lines = v.replace(/>\s+</g, '>\n<').split('\n');
      let depth=0;
      const out = lines.map(l=>{
        if(l.match(/^<\/\w/)) depth = Math.max(0, depth-1);
        const pad = '  '.repeat(depth);
        if(l.match(/^<[^/!][^>]*>$/) && !l.match(/\/>$/) && !l.match(/^<.*>.*<\/.*>$/)) { depth++; }
        return pad + l.trim();
      }).join('\n');
      document.getElementById('tf-in').value = out;
    }

    /*********************
      small helpers
    *********************/
    function showToast(msg){
      console.log(msg);
    }

    // keyboard shortcuts: numbers for quick tools (1..9)
    document.addEventListener('keydown', (e)=>{
      if(e.key === '1') showTool('notes');
      if(e.key === '2') showTool('stopwatch');
      if(e.key === '3') showTool('datediff');
      if(e.key === '4') showTool('worldclock');
      if(e.key === '5') showTool('password');
      if(e.key === '6') showTool('clipboard');
      if(e.key === '7') showTool('filesize');
      if(e.key === '8') showTool('charword');
      if(e.key === '9') showTool('caseconv');
      if(e.key === '0') showTool('textformat');
    });

    /* Make sure header 'by PirateRuler.com' small similar to calculator site */
    // already set via .brand p

    // â€” final small tweak: ensure theme is applied immediately
    document.addEventListener('DOMContentLoaded', ()=> {
      applyTheme(localStorage.getItem('pr-theme') || (window.matchMedia && window.matchMedia('(prefers-color-scheme: dark)').matches ? 'dark' : 'light'));
    });

  </script>
</body>
</html>
